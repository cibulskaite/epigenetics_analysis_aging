devtools::install_github("danbelsky/DunedinPoAm38")
devtools::install_github("danbelsky/DunedinPACE")
devtools::install_github("HigginsChenLab/methylCIPHER")
devtools::install_github("karoliskoncevicius/annmatrix@dev")

library(remotes)
install_github("karoliskoncevicius/matrixTests@dev_lm")

install.packages("annmatrix")
library(annmatrix)

library(methylCIPHER)

library(ggplot2)

library(data.table)

install.packages("VennDiagram")
library(VennDiagram)
library(basetheme)
library(matrixTests)
install.packages("ggpubr")
library(ggpubr)
library(dplyr)
library(broom)
library(scales)
library(IlluminaHumanMethylationEPICanno.ilm10b4.hg19)
library(IlluminaHumanMethylation450kanno.ilmn12.hg19)



# df is annmatrix with methylation and sample data

dfPheno <- data.frame(Sample_ID = df$id,
                            gender = df$sex,
                            Age = df$age,
                            group = df$diagnosis,
                            Female = df$sex)

dfPheno$group <- ifelse(dfPheno$group == "control", 0, 1)
dfPheno$Female <- ifelse(dfPheno$Female == "M", 0, 1)

userClocks <- c("calcAdaptAge", "calcDunedinPoAm38", "calcHannum", "calcHorvath2",
                "calcZhang2019", "calcEpiTOC", "calcHorvath1",  "calcPhenoAge",
                "calcZhang",  "calcDamAge", "calcDNAmTL")

clock_list <- c("Sample_ID", "gender", "Age", "group", "data_pckg", "DamAge",
                "AdaptAge", "CausAge", "PhenoAge", "DunedinPoAm38", "Hannum",
                "Horvath1", "Horvath2", "Zhang", "Zhang2019", "EpiTOC", "DNAmTL",
                "Age_prediction", "PCHorvath1", "PCHorvath2", "PCHannum",
                "PCPhenoAge", "PCDNAmTL", "PCGrimAge", "intrinClock", "clockCage")

df_clocks <- calcUserClocks(userClocks, t(df), dfPheno, imputation = F)

df_pcclocks <- calcPCClocks(t(as.matrix(df_progeria)), dfPheno)
df_clocks <- merge(df_clocks, df_pcclocks)


df_intrin <- data.frame(intrinClock = clock_intrinclock(df))
df_intrin$Sample_ID <- rownames(df_intrin)
df_clocks <- merge(df_clocks, df_intrin)


df_cage <- data.frame(clockCage = clock_cage(df))
df_cage$Sample_ID <- rownames(df_cage)
df_clocks <- merge(df_clocks, df_cage)

df_clocks$data_pckg <- "disease_name"


# repeat the same with all data
# disease names:
#df_ncs is NCS
#df_progeria is HGPS
#df_werner is Werner



# bind all

clocks_data <- rbind(rbind(df_progeria, df_ncs), df_werner)

clocks_data$group <- ifelse(clocks_data$group == 0, "control", "disease")

clocks_data <- clocks_data %>%
  select(all_of(clock_list)) %>%
  rename(Horvath = Horvath1) %>%
  rename(SkinAndBlood = Horvath2) %>%
  rename(PCHorvath = PCHorvath1) %>%
  rename(PCSkinAndBlood = PCHorvath2) %>%
  rename(SystemsAge = Age_prediction) %>%
  rename(C_age = clockCage)


clock_names <- colnames(clocks_data)[6:26]


# sig_clocks - store all clock calculations of all diseases

sig_clocks <- data.frame(Clock_names = character(0),
                         Disease = character(0),
                         pvals = numeric(0),
                         Median = numeric(0),
                         MedianDiff = numeric(0),
                         stringsAsFactors = FALSE)


# violin plots of clocks results
plot_clock_violin <- function(df, clock_name) {
  
  df$clock_name <- df[[clock_name]]
  
  df <- df %>%
    group_by(data_pckg) %>%
    mutate(residuals = residuals(lm(clock_name ~ Age))) %>%
    ungroup()
  
  pkgs <- unique(df$data_pckg)
  
  lim <- diff(range(df$residuals)) * 0.8
  global_ylim <- range(df$residuals) + c(0-lim, lim)
  
  par(mfrow = c(1, length(pkgs)), mar = c(4, 2, 3, 1))
  par(oma = c(4, 4, 0, 0))
  
  for (pkg in pkgs) {
    
    sub <- df[df$data_pckg == pkg, ]
    
    dens <- tapply(sub$residuals, sub$group, density)
    
    cols <- hcl.colors(length(dens), "Zissou")
    
    xs <- Map(getElement, dens, "y")
    ys <- Map(getElement, dens, "x")
    
    xs <- Map(c, xs, Map(rev, Map(`*`, -1, xs)))
    ys <- Map(c, ys, Map(rev, ys))
    
    xs <- Map(function(x) (x - min(x)) / max(x - min(x)) * 0.4, xs)
    xs <- Map(`+`, xs, 1:length(xs))
    
    plot.new()
    plot.window(
      xlim = c(0.5, length(xs) + 0.5),
      ylim = global_ylim
    )
    
    par(xpd = FALSE)
    grid(nx = NA, ny = NULL, lwd = 1.5)
    
    Map(polygon, xs, ys, col = cols)
    
    axis(2, las = 1)
    
    title(pkg, font = 2, line = 0)
    
    medians <- tapply(sub$residuals, sub$group, median)
    x_centers <- sapply(xs, function(x) mean(range(x)))
    segments(
      x0 = x_centers - 0.2,
      x1 = x_centers + 0.2,
      y0 = medians,
      y1 = medians,
      lwd = 1,
      col = "black"
    )
    
    groups <- unique(sub$group)
    if (length(groups) == 2) {
      p_val <- t.test(residuals ~ group, data = sub)$p.value
    } else {
      p_val <- summary(aov(residuals ~ group, data = sub))[[1]][["Pr(>F)"]][1]
    }


   sig_clocks <<- rbind(sig_clocks, data.frame(Clock_names = clock_name,
                                                Disease = pkg,
                                                Median = medians[["disease"]],
                                                MedianDiff = medians[["disease"]] - medians[["control"]],
                                                pvals = p_val,
                                                stringsAsFactors = FALSE)
                        )


    y_pos <- max(sub$residuals, na.rm = TRUE) + 0.1 * diff(global_ylim)
    text(x = 1.8, 
         y = y_pos,
         labels = paste0("p = ", signif(p_val, 3)),
         cex = 2)
    
    mtext(paste(clock_name, "age acceleration"), side = 2, outer = TRUE,
          line = 1, las = 0, font = 1.3)
  }
  par(xpd = NA)
  
  llim <- diff(range(df$residuals)) * 0.2
  
  legend(x = -1, y = global_ylim[1] - llim,
         legend = names(dens), fill = cols,
         ncol = length(cols),
         bty = "n", cex = 2,
         inset = 0,
         xjust = 0.5, yjust = 0.5) 
  
}



lapply(clock_names, function(clock) {
  
  png(filename = paste0("clock_residuals_violin_lm_", clock, ".png"),
      width = 10, height = 6, units = "in", res = 300)
  
  plot_clock_violin(clocks_data, clock)
  
  dev.off()
})

# dot chart for clocks results summary

sig_thresh <- 0.05

sig_df  <- sig_clocks[sig_clocks$pval <= sig_thresh, ]
nonsig_df <- sig_clocks[sig_clocks$pval > sig_thresh, ]

disease_cols <- c(
  NCS    = "#60BD68",
  HGPS   = "steelblue3",
  Werner = "slateblue3"
)

clocks <- unique(sig_clocks$Clock_names)
ys <- seq_along(clocks)
names(ys) <- clocks

xlim <- range(sig_clocks$MedianDiff, na.rm = TRUE)
x_pad <- diff(xlim) * 0.1
xlim <- c(xlim[1] - x_pad, xlim[2] + x_pad)

plot.new()
plot.window(
  xlim = xlim,
  ylim = c(min(ys) - 0.2, max(ys) + 0.2)
)

abline(v = 0, col = "grey", lty = 2)

for (y in ys) {
  segments(
    x0 = xlim[1],
    x1 = xlim[2],
    y0 = y,
    y1 = y,
    col = "grey",
    lty = "dotted",
    lwd = 1
  )
}


for (i in seq_len(nrow(sig_df))) {
  row <- sig_df[i, ]
  
  points(
    x = row$MedianDiff,
    y = ys[as.character(row$Clock_names)] +
      runif(1, -0.15, 0.15),
    col = disease_cols[row$Disease],
    pch = 19,    # filled circle
    cex = 2
  )
}


ticks <- seq(-5, 320, by = 5)
axis(1, at = ticks, cex.axis = 0.7)
axis(2, at = ys, labels = clocks, las = 2, cex.axis = 0.45)

title(
  main = "Age acceleration per clock",
  xlab = "Age acceleration",
  ylab = "",
  cex.main = 0.9,
  cex.lab  = 0.8
)

par(xpd = TRUE)

legend(
  "topright",
  legend = c("NCS", "HGPS", "Werner"),
  col = disease_cols[c("NCS", "HGPS", "Werner")],
  pch = 19,
  cex = 0.7,
  bty = "n",
)
'
legend(
  "bottomright",
  legend = c("Significant", "Not significant"),
  pch = c(19, 1),
  cex = 0.7,
  bty = "n"
)
'
par(xpd = FALSE)

dev.off()




# searching for DMCs

# remove SNPs

# info_snps_EPIC holds information on EPIC array SNPs
# info_snps_HM45 hold information on HM450 array SNPs


snps_EPIC <- info_snps_EPIC$probeID[info_snps_EPIC$MASK_general == "TRUE"]

df_progeria_noSNP <- df_progeria[!rownames(df_progeria) %in% snps_EPIC, ]

df_werner_noSNP <- df_werner[!rownames(df_werner) %in% snps_EPIC, ]


snps_HM450 <- info_snps_HM450$probeID[info_snps_HM450$MASK_general == "TRUE"]

df_ncs_noSNP <- df_ncs[!rownames(data_ncs) %in% snps_HM450, ]



# JACK KNIFE FOR NCS DATA
cgs <- rownames(df_ncs_jacked_noSNP_all)

samples <- colnames(df_ncs_jacked_noSNP[,df_ncs_jacked_noSNP$diagnosis == "ncs"])

mod0 <- model.matrix(~ df_ncs_jacked_noSNP$age)
mod1 <- model.matrix(~ df_ncs_jacked_noSNP$age + df_ncs_jacked_noSNP$diagnosis)

res_ncs_2_jacked <- data.frame(cg = character(0),
                               pvalue = numeric(0))

n_samples <- ncol(df_ncs_jacked_noSNP_all)

pvals_jack <- matrix(
  NA_real_,
  nrow = nrow(df_ncs_jacked_noSNP_all),
  ncol = n_samples,
  dimnames = list(rownames(df_ncs_jacked_noSNP_all), colnames(df_ncs_jacked_noSNP_all))
)

for (i in seq_len(n_samples)) {
  
  keep <- setdiff(seq_len(n_samples), i)
  
  y_jack <- data_ncs_jacked_noSNP_all[, keep, drop = FALSE]
  
  mod0 <- model.matrix(~ y_jack$age + y_jack$diagnosis)
  mod1 <- model.matrix(~ y_jack$age + y_jack$diagnosis + y_jack$age:y_jack$diagnosis)
  
  res <- row_lm_f(y_jack, mod1, mod0)
  
  pvals_jack[, i] <- res$pvalue
}

# jackknife p-value = worst-case (max) across leave-one-out fits
pval_max <- apply(pvals_jack, 1, max, na.rm = TRUE)

pval_max <- res_ncs_1_jacked$pvalue

pval_max_fdr <- p.adjust(pval_max, "fdr")

res_ncs_1_jacked_fdr <- data.frame(
  cg = rownames(df_ncs_jacked_noSNP_all),
  pvalue_jack = pval_max,
  pvalue_jack_fdr = pval_max_fdr
)




# df_noSNP is methylation data from one disease without SNPs


# find DMCs with static differences - no interaction

mod0 <- model.matrix(~ df_noSNP$age)
mod1 <- model.matrix(~ df_noSNP$age + df_noSNP$diagnosis)

res_noint <- row_lm_f(df_noSNP, mod1, mod0)


i <- order(res_noint$pvalue)[1:5]

cpgs_noint <- res_noint$pvalue[i]
names(cpgs_noint) <- rownames(res_noint)[i]
cpgs_noint <- cpgs_noint[order(cpgs_noint)]


j <- p.adjust(res_noint$pvalue, "fdr") <= 0.05

cpgs_noint_fdr <- res_noint$pvalue[j]
names(cpgs_noint_fdr) <- rownames(res_noint)[j]
cpgs_noint_fdr <- cpgs_noint_fdr[order(cpgs_noint_fdr)[j]


# find DMCs with dynamic differences - interaction

mod0 <- model.matrix(~ df_noSNP$age + df_noSNP$diagnosis)
mod1 <- model.matrix(~ df_noSNP$age + df_noSNP$diagnosis + df_noSNP$age:df_noSNP$diagnosis)

res_int <- row_lm_f(df_noSNP, mod1, mod0)

k <- order(res_int$pvalue)[1:5]

cpgs_int <- res_int$pvalue[k]
names(cpgs_int) <- rownames(res_int)[k]
cpgs_int <- cpgs_int[order(cpgs_int)]


l <- p.adjust(res_int$pvalue, "fdr") <= 0.05

cpgs_int_fdr <- res_int$pvalue[l]
names(cpgs_int_fdr) <- rownames(res_int)[l]
cpgs_int_fdr <- cpgs_int_fdr[order(cpgs_int_fdr)[l]



# List of datasets and their disease labels

datasets <- list(
  "NCS"      = df_ncs_noSNP[,df_ncs_noSNP$diagnosis == "NCS"],
  "control NCS" = df_ncs_noSNP[,df_ncs_noSNP$diagnosis == "control NCS"],
  "HGPS" = df_progeria_noSNP[,df_progeria_noSNP$diagnosis == "HGPS"],
  "control HGPS" = df_progeria_noSNP[,df_progeria_noSNP$diagnosis == "control HGPS"],
  "Werner" = df_werner_noSNP[,df_werner_noSNP$diagnosis == "Werner"],
  "control Werner" = df_werner_noSNP[,df_werner_noSNP$diagnosis == "control Werner"]
)


# Colors for disease

disease2col <- c(
  "controls" = "lightgrey",
  "control HGPS" = "deepskyblue",
  "HGPS" = "steelblue3",
  "control Werner" = "mediumpurple1",
  "Werner" = "slateblue3",
  "control NCS" = "lightgreen",
  "NCS" = "#60BD68"
)


format_p_NCS <- function(p) {
  if (is.na(p)) return("p = NA")
  if (p < 1e-3) {
    paste0("NCS p = ", formatC(p, format = "e", digits = 2))
  } else {
    paste0("NCS p = ", signif(p, 3))
  }
}

format_p_WS <- function(p) {
  if (is.na(p)) return("p = NA")
  if (p < 1e-3) {
    paste0("WS p = ", formatC(p, format = "e", digits = 2))
  } else {
    paste0("WS p = ", signif(p, 3))
  }
}

format_p_HGPS <- function(p) {
  if (is.na(p)) return("p = NA")
  if (p < 1e-3) {
    paste0("HGPS p = ", formatC(p, format = "e", digits = 2))
  } else {
    paste0("HGPS p = ", signif(p, 3))
  }
}

xlim <- c(0,35)
ylim <- c(0,100)

dev.off()

# additional control datasets are in controls_epic and controls_450k
# ncs_cpgs, progeria_cpgs, werner_cpgs are vectors with p values of top 5 cytosines and their names

# Open PDF
pdf("cpgs_profiles.pdf", width = 15/2.54, height = 4/2.54, pointsize = 8)
par(mfrow = c(1,5), mar = c(2,1,4,1), oma = c(3,5,1,2), tck = -0.02, mgp = c(2,0.5,0), lwd = 0.5)

for(cg in cgs) {
  
  p_ncs <- numeric(0)
  p_ws <- numeric(0)
  p_hgps <- numeric(0)

  all_y <- unlist(lapply(datasets, function(d) {
    if(cg %in% rownames(d)) d[cg,]*100 else NULL
  }))
  ylim_cur <- c(0,100)
  ylim_cur <- ylim_cur + c(-0.05, 0.05) * diff(ylim_cur)


  plot(NA, xlim = xlim, ylim = ylim_cur, xlab = "", yaxt = "n",  xaxt = "n",yaxs = "i", type = "n")
  
  if (cg %in% rownames(controls_epic)) {
    points(controls_epic$age, controls_epic[cg,] * 100, 
           col = adjustcolor("lightgrey", alpha.f = 0.1), 
           pch = 19, cex = 1)
  }
  if (cg %in% rownames(controls_450k)) {
    points(controls_450k$age, controls_450k[cg,] * 100, 
           col = adjustcolor("lightgrey", alpha.f = 0.1), 
           pch = 19, cex = 1)
  }
  
  for(disease in names(datasets)) {
    d <- datasets[[disease]]
    if(cg %in% rownames(d)) {
      y_vals <- d[cg,] * 100
      x_vals <- d$age
      
      if (disease != "controls"){
      points(x_vals + runif(length(x_vals), -0.2, 0.2), y_vals, 
             col = "black", bg =adjustcolor(disease2col[disease], alpha.f = 0.9), 
             pch = 21, cex = 1)
      
      abline(h = mean(y_vals, na.rm = TRUE), 
             col = adjustcolor(disease2col[disease], alpha.f = 0.4), 
             lwd = 2, lty = 2)  # dashed
      
      if(length(x_vals) > 1) {
        fit <- lm(y_vals ~ x_vals)
        x_line <- range(x_vals, na.rm = TRUE)
        y_line <- predict(fit, newdata = data.frame(x_vals = x_line))
        lines(x_line, y_line, col = adjustcolor(disease2col[disease], alpha.f = 0.4),
              lwd = 2)
      }
    
    
      if (disease == "NCS") {
        p_ncs <<- ncs_cpgs[[cg]]
      } else if (disease == "HGPS") {
        p_hgps <<- progeria_cpgs[[cg]]
      } else if (disease == "Werner") {
       p_ws <<- werner_cpgs[[cg]]
      }
      
    }
   }
  title(cg, line = 0.5)
  

    title(ylab = "Modification (%)", line = 2.5, font = 1, outer = TRUE)
    axis(2, las = 2, lwd = 0.5, lwd.ticks = 0.5)
    x_ticks <- seq(floor(xlim[1]), ceiling(xlim[2]), by = 10,)
    axis(1, at = x_ticks, labels = x_ticks, cex.axis = 1, lwd = 0.5, lwd.ticks = 0.5)
    title(xlab = "Age (years)", line = 1.5, font = 1, outer = TRUE)


  }
  legend("topright",
         legend = paste(c( "p = "),
                        signif(c(p_ncs), 2)),
         bty = 'n',
         cex = 0.7
  )
}

legend(
  x      = "bottomright",
  legend = names(datasets),
  text.width = strwidth(names(datasets)),
  col    = disease2col,
  pch    = 19,
  bty    = 'n',
  inset  = c(0, 1.2),
  xpd    = NA,
  horiz  = TRUE
)

invisible(dev.off())



pdf("venn_noint.pdf", width = 4, height = 4, pointsize = 10)

venn_common_noint <- venn.diagram(
  x = list(
    NCS    = ncs_noint,
    HGPS = names(progeria_noint),
    Werner = names(werner_noint)
  ),
  fill = c("#60BD68","steelblue3","slateblue3"),
  alpha = 0.5,
  
  cat.pos = c(-30, 30, -180),     # label angles
  cat.dist = c(0.05, 0.05, 0.03),  # distance from circles
  
  filename = NULL,
  width = 2500,
  height = 2500,
  resolution = 300
)



grid::grid.draw(venn_common_noint)
invisible(dev.off())

grid::grid.newpage()

common_int_fdr <- intersect(ncs_int_fdr, progeria_int_fdr)
common_int_fdr <- intersect(common_int_fdr, werner_int)


common_all_int <- intersect(intersect(ncs_int, progeria_int), werner_int)



common_ncs_int_fdr_fromall <- intersect(common_all_int, ncs_int_fdr)


common_progeria_int_fdr_fromall <- intersect(common_all_int, progeria_int_fdr)
#nera bendru
common_ncsprogeria_int_fdr <- intersect(ncs_int_fdr, progeria_int_fdr)


common_noint_from_wernerncs <- intersect(ncs_noint, werner_noint)
common_noint_all <- length(intersect(common_noint_from_wernerncs, progeria_noint_classic))
ncs_fdr_noint_from_common_wernerncs <- intersect(ncs_noint_fdr, common_noint_from_wernerncs) #3
werner_fdr_noint_from_common_wernerncs <- intersect(werner_noint_fdr, common_noint_from_wernerncs) #0


common_noint_wernerprogeria <- intersect(werner_noint, progeria_noint)
common_progeriawerner_noint_fdr <- intersect(werner_noint_fdr, common_noint_wernerprogeria) #13

intersect(common_progeriawerner_noint_fdr, ncs_noint)#0

werner_fdr_noint_from_common_wernerncs <- intersect(werner_noint_fdr, common_noint_from_wernerncs) #48
# intersect of both - 1 ("cg10493186")
cg_noint <- "cg10493186"
werner_fdr_noint_from_common_all <- intersect(werner_noint_fdr, common_noint_all)#0

common_noint_from_progeriancs <- intersect(ncs_noint, progeria_noint_classic) #939
ncs_fdr_noint_from_common_progeriancs <- intersect(ncs_noint_fdr, common_noint_from_progeriancs) #0

common_noint_from_wernerprogeria <- intersect(werner_noint, progeria_noint)
common_noint_from_wernerprogeria_classic <- intersect(werner_noint, progeria_noint_classic)
werner_fdr_noint_from_common_progeriawerner <- intersect(werner_noint_fdr, common_noint_from_wernerprogeria) #13, nera common su ncs
werner_fdr_noint_from_common_progeriawerner_classic <- intersect(werner_noint_fdr, common_noint_from_wernerprogeria_classic)



ncs_int_from_all <- which(common_all_int %in% ncs_int_fdr)
progeria_int_from_all <- which(common_all_int %in% progeria_int_fdr)

common_all_noint <- intersect(intersect(ncs_noint, progeria_noint), werner_noint)



# plotting

lapply(common_ncs_progeria_all, function(cpg) {
  png(filename = paste0("common_ncs_progeria_int_all_", cpg, ".png"),
      width = 6, height = 6, units = "in", res = 300)
  
  dev.off()
})

color_map <- c(
  "control_ncs"      = "pink",
  "ncs"       = "purple",
  "control_werner"   = "orange",
  "werner"    = "red",
  "control_hgps" = "green",
  "hgps"  = "blue"
)


lapply (common_ncs_progeria_all, function (cpg) {
  
  df_ncs <- data.frame(Methylation = data_ncs_noSNP[cpg,],
                   Age = data_ncs_noSNP$age,
                   Group = data_ncs_noSNP$diagnosis)
  
  df_ncs$Group[df_ncs$Group == "control"] <- "control_ncs"
  
  df_progeria <- data.frame(Methylation = data_progeria_noSNP[cpg,],
                            Age = data_progeria_noSNP$age,
                            Group = data_progeria_noSNP$diagnosis)
  
  df_progeria$Group[df_progeria$Group == "control"] <- "control_hgps"
  
  df <- rbind(df_ncs, df_progeria)
  
  p <- ggplot(df, aes(x = Age, y = Methylation, color = Group)) +
    geom_point(alpha = 0.7) +
    scale_color_manual(values = color_map) +
    geom_smooth(method = "lm", se = FALSE) +
    labs(
      title = paste(cpg),
      x = "Age",
      y = "Methylation",
      color = "Disease Group"
    ) +
    theme_bw() +
    theme(
      legend.position = "right",
      legend.title = element_text(size = 10),
      legend.text  = element_text(size = 8))
  
  ggsave(
    filename = paste0("werner_progeria_noSNPS_", cpg, ".png"),
    plot = p,
    width = 10,
    height = 6,
    dpi = 300
  )
  
} )



common_ncs_werner_noint <- intersect(cpgs_ncs_1_all, cpgs_werner_1_classic)

lapply (common_ncs_werner_noint, function (cpg) {
  
  df_ncs <- data.frame(Methylation = data_ncs_noSNP[cpg,],
                       Age = data_ncs_noSNP$age,
                       Group = data_ncs_noSNP$diagnosis)
  
  df_ncs$Group[df_ncs$Group == "control"] <- "control_ncs"
  
  df_werner <- data.frame(Methylation = data_werner_noSNP[cpg,],
                            Age = data_werner_noSNP$age,
                            Group = data_werner_noSNP$diagnosis)
  
  df_werner$Group[df_werner$Group == "control"] <- "control_werner"
  
  df <- rbind(df_ncs, df_werner)
  
  p <- ggplot(df, aes(x = Age, y = Methylation, color = Group)) +
    geom_point(alpha = 0.7) +
    scale_color_manual(values = color_map) +
    geom_smooth(method = "lm", se = FALSE) +
    labs(
      title = paste(cpg),
      x = "Age",
      y = "Methylation",
      color = "Disease Group"
    ) +
    theme_bw() +
    theme(
      legend.position = "right",
      legend.title = element_text(size = 10),
      legend.text  = element_text(size = 8))
  
  ggsave(
    filename = paste0("ncs_werner_noint_noSNPS_", cpg, ".png"),
    plot = p,
    width = 10,
    height = 6,
    dpi = 300
  )
  
} )


common_ncs_int_werner <- intersect(cpgs_ncs_2_all, cpgs_werner_1_classic)

lapply (common_ncs_int_werner, function (cpg) {
  
  df_ncs <- data.frame(Methylation = data_ncs_noSNP[cpg,],
                       Age = data_ncs_noSNP$age,
                       Group = data_ncs_noSNP$diagnosis)
  
  df_ncs$Group[df_ncs$Group == "control"] <- "control_ncs"
  
  df_werner <- data.frame(Methylation = data_werner_noSNP[cpg,],
                          Age = data_werner_noSNP$age,
                          Group = data_werner_noSNP$diagnosis)
  
  df_werner$Group[df_werner$Group == "control"] <- "control_werner"
  
  df <- rbind(df_ncs, df_werner)
  
  p <- ggplot(df, aes(x = Age, y = Methylation, color = Group)) +
    geom_point(alpha = 0.7) +
    scale_color_manual(values = color_map) +
    geom_smooth(method = "lm", se = FALSE) +
    labs(
      title = paste(cpg),
      x = "Age",
      y = "Methylation",
      color = "Disease Group"
    ) +
    theme_bw() +
    theme(
      legend.position = "right",
      legend.title = element_text(size = 10),
      legend.text  = element_text(size = 8))
  
  ggsave(
    filename = paste0("ncs_int_werner_noSNPS_", cpg, ".png"),
    plot = p,
    width = 10,
    height = 6,
    dpi = 300
  )
  
} )




# GO ANALYSIS

ncs_fdr_all <- unique(c(ncs_int_fdr_all, ncs_noint_fdr_all))
progeria_fdr_all <- progeria_int_fdr_all
werner_fdr_all <- werner_noint_fdr_all

saveRDS(ncs_fdr_all, file="ncs_DMCs.RData")
saveRDS(progeria_fdr_all, file="progeria_DMCs.RData")
saveRDS(werner_fdr_all, file="werner_DMCs.RData")

ncs_fdr_all <- readRDS("ncs_DMCs.RData")
progeria_fdr_all <- readRDS("progeria_DMCs.RData")
werner_fdr_all <- readRDS("werner_DMCs.RData")

ncs_all <- rownames(data_ncs_noSNP)
progeria_all <- rownames(data_progeria_noSNP)
werner_all <- rownames(data_werner_noSNP)

inter1 <- intersect(ncs_fdr_all, progeria_fdr_all)
inter2 <- intersect(ncs_fdr_all, werner_fdr_all)
inter3 <- intersect(werner_fdr_all, progeria_fdr_all)

'
disease2col <- c(
  "control NCS" = "lightgreen",
  "control Werner" = "mediumpurple1",
  "Werner" = "slateblue3",
  "control HGPS" = "deepskyblue",
  "HGPS" = "steelblue3",
  "NCS" = "#60BD68"
)
'


ncs_noint_downregulated <- numeric()
ncs_noint_upregulated   <- numeric()

ncs_noint_downregulated <- ncs_noint_jacked_mean_GO[ncs_noint_jacked_mean_GO > ncs_noint_jacked_mean_GO_controls]
ncs_noint_upregulated   <- ncs_noint_jacked_mean_GO[ncs_noint_jacked_mean_GO < ncs_noint_jacked_mean_GO_controls]

df_up <- ncs_noint_jacked[ncs_noint_jacked$cg %in% names(ncs_noint_upregulated),]
df_up <- df_up[order(df_up$pvalue_jack), ]
ncs_noint_jacked_upregulated_top100 <- head(df_up$cg, 100)


noint_werner_mean <- data_werner[werner_noint_fdr_all,]
noint_werner_mean_control <- noint_werner_mean[,noint_werner_mean$diagnosis == "control"]
noint_werner_mean_disease<- noint_werner_mean[,noint_werner_mean$diagnosis == "werner"]
werner_noint_jacked_mean_GO <- rowMeans(noint_werner_mean_disease)
werner_noint_jacked_mean_GO_control <- rowMeans(noint_werner_mean_control)

werner_noint_downregulated <- numeric()
werner_noint_upregulated   <- numeric()

werner_noint_downregulated <- werner_noint_jacked_mean_GO[werner_noint_jacked_mean_GO > werner_noint_jacked_mean_GO_control]
werner_noint_upregulated <- werner_noint_jacked_mean_GO[werner_noint_jacked_mean_GO < werner_noint_jacked_mean_GO_control]

df_down_werner <- res_werner_1[rownames(res_werner_1) %in% names(werner_noint_downregulated),]
df_down_werner <- df_down_werner[order(df_down_werner$pvalue), ]
werner_noint_downregulated_top100 <- head(rownames(df_down_werner), 100)

noint_progeria_mean <- data_progeria_noSNP[progeria_noint,]
noint_progeria_mean_control <- noint_progeria_mean[,noint_progeria_mean$diagnosis == "control HGPS"]
noint_progeria_mean_disease<- noint_progeria_mean[,noint_progeria_mean$diagnosis == "HGPS"]
progeria_noint_jacked_mean_GO <- rowMeans(noint_progeria_mean_disease)
progeria_noint_jacked_mean_GO_control <- rowMeans(noint_progeria_mean_control)

progeria_noint_downregulated <- numeric()
progeria_noint_upregulated   <- numeric()

progeria_noint_downregulated <- progeria_noint_jacked_mean_GO[progeria_noint_jacked_mean_GO > progeria_noint_jacked_mean_GO_control]
progeria_noint_upregulated <- progeria_noint_jacked_mean_GO[progeria_noint_jacked_mean_GO < progeria_noint_jacked_mean_GO_control]

df_down_progeria <- res_progeria_1[rownames(res_progeria_1) %in% names(progeria_noint_downregulated),]
df_down_progeria <- df_down_progeria[order(df_down_progeria$pvalue), ]
progeria_noint_downregulated_top100 <- head(rownames(df_down_progeria), 100)

df_up_progeria <- res_progeria_1[rownames(res_progeria_1) %in% names(progeria_noint_upregulated),]
df_up_progeria <- df_up_progeria[order(df_up_progeria$pvalue), ]
progeria_noint_upregulated_top100 <- head(rownames(df_up_progeria), 100)

#### INTERACTION ####
int_ncs_mean <- data_ncs[ncs_int_jacked$cg,]

int_ncs_mean_control <- int_ncs_mean[,int_ncs_mean$diagnosis == "control"]
int_ncs_mean_disease<- int_ncs_mean[,int_ncs_mean$diagnosis == "ncs"]
ncs_int_jacked_mean_GO <- rowMeans(int_ncs_mean_disease)
ncs_int_jacked_mean_GO_control <- rowMeans(int_ncs_mean_control)

ncs_int_downregulated <- numeric()
ncs_int_upregulated   <- numeric()

ncs_int_downregulated <- ncs_int_jacked_mean_GO[ncs_int_jacked_mean_GO > ncs_int_jacked_mean_GO_control]
ncs_int_upregulated <- ncs_int_jacked_mean_GO[ncs_int_jacked_mean_GO < ncs_int_jacked_mean_GO_control]

df_down_ncs_int <- ncs_int_jacked[ncs_int_jacked$cg %in% names(ncs_int_downregulated),]
df_down_ncs_int <- df_down_ncs_int[order(df_down_ncs_int$pvalue_jack), ]
ncs_int_downregulated_top100 <- head(rownames(df_down_ncs_int), 100)

df_up_ncs_int <- ncs_int_jacked[ncs_int_jacked$cg %in% names(ncs_int_upregulated),]
df_up_ncs_int <- df_up_ncs_int[order(df_up_ncs_int$pvalue_jack), ]
ncs_int_upregulated_top100 <- head(rownames(df_up_ncs_int), 100)


saveRDS(df_up_progeria, "df_up_progeria.RData")

BiocManager::install("IlluminaHumanMethylationEPICanno.ilm10b4.hg38")
BiocManager::install("IlluminaHumanMethylation450kanno.ilmn12.hg38")
BiocManager::install("clusterProfiler")
BiocManager::install("missMethyl")
BiocManager::install("karyoploteR")

library(IlluminaHumanMethylationEPICanno.ilm10b4.hg19)
library(IlluminaHumanMethylation450kanno.ilmn12.hg19)
library(dplyr)
library(tidyr)
library(clusterProfiler)
library(org.Hs.eg.db)
library(missMethyl)
library(karyoploteR)
library(biomaRt)
library(tidyr)

ensembl <- useEnsembl(biomart="ensembl", dataset="hsapiens_gene_ensembl", mirror = "www")

gometh(
  sig.cpg = ncs_fdr_all,
  all.cpg = ncs_all,
  collection = "GO"
)


top_go <- go_df_ncs_int_down %>%
  filter(ONTOLOGY == "MF") %>%
  arrange(FDR) %>%
  slice_head(n = 10)

top_go[["TERM"]] <- as.character(top_go[["TERM"]])
ggplot(top_go, aes(x = reorder(`TERM`, -log10(FDR)),
                      y = -log10(FDR))) +
  geom_col() +
  coord_flip() +
  labs(x = "", y = "-log10(FDR)",
       title = "Top GO MF Processes") +
  theme_bw()





anno_epic <- getAnnotation(IlluminaHumanMethylationEPICanno.ilm10b4.hg19)
anno_450k <- getAnnotation(IlluminaHumanMethylation450kanno.ilmn12.hg19)

coords_epic <- as.data.frame(anno_epic[, c("Name", "chr", "pos")])
coords_450k <- as.data.frame(anno_450k[, c("Name", "chr", "pos")])



# Select CpG ID and gene column
cpg2gene_450k <- anno_450k[, c("Name", "UCSC_RefGene_Name")]
cpg2gene_epic <- anno_epic[, c("Name", "UCSC_RefGene_Name")]

cpg2gene_450k <- as.data.frame(cpg2gene_450k)
cpg2gene_epic <- as.data.frame(cpg2gene_epic)



# Split multiple genes per CpG into separate rows
cpg2gene_450k <- cpg2gene_450k %>%
  tidyr::separate_rows(UCSC_RefGene_Name, sep = ";") %>%
  dplyr::filter(UCSC_RefGene_Name != "")  # remove CpGs with no gene

cpg2gene_epic <- cpg2gene_epic %>%
  tidyr::separate_rows(UCSC_RefGene_Name, sep = ";") %>%
  dplyr::filter(UCSC_RefGene_Name != "") 





# Function to convert CpGs â†’ gene symbols
cpgs_to_genes <- function(cpg_list, mapping_df) {
  mapping_df %>%
    dplyr::filter(Name %in% cpg_list) %>%
    pull(UCSC_RefGene_Name) %>%
    unique()
}

werner_noint_map <- names(werner_noint)[1:200]
ncs_noint_map <- names(ncs_noint_jacked_all)[1:200]
progeria_noint_map <- names(progeria_noint)[1:200]

genes_progeria_hypo <- cpgs_to_genes(progeria_hypo, cpg2gene_epic)
genes_ncs_hypo <- cpgs_to_genes(ncs_hypo, cpg2gene_450k)
genes_werner_hypo <- cpgs_to_genes(werner_hypo, cpg2gene_epic)




library(GenomicRanges)


get_genes <- function(symbols, disease_name) {
  gr <- toGRanges(
    getBM(
      attributes = c("chromosome_name", "start_position", "end_position", "hgnc_symbol"),
      filters = "hgnc_symbol",
      values = symbols,
      mart = ensembl
    )
  )
  gr$disease <- disease_name
  return(gr)
}

genes_progeria_hypo_gr <- get_genes(genes_progeria_hypo, "HGPS")
genes_ncs_hypo_gr <- get_genes(genes_ncs_hypo, "NCS")
genes_werner_hypo_gr <- get_genes(genes_werner_hypo, "Werner")

genes <- c(genes_progeria_int_hyper_gr, genes_ncs_int_hyper_gr, genes_werner_int_hyper_gr)
genes <- c(genes_progeria_hyper_gr, genes_ncs_hyper_gr, genes_werner_hyper_gr)
genes <- c(genes_werner_hyper_gr, genes_ncs_hype_gr, genes_werner_noint_hypo_gr)
genes <- c(genes_werner_hypo_gr)
seqlevelsStyle(genes) <- "UCSC"


disease_colors <- c(
  "Werner" = "slateblue3",
  "HGPS" = "steelblue3",
  "NCS" = "#60BD68"
)

disease_colors <- c(
  "NCS and HGPS" = "steelblue3"
)

library(karyoploteR)

ensembl <- useEnsembl(biomart="ensembl", dataset="hsapiens_gene_ensembl")

dev.off()

pdf("karyoteR_hypermethylated_chr5.pdf", width = 4, height = 4, pointsize = 6)
par(mar = c(4,0,4,1),
    oma = c(0,4,0,0),
    tck = -0.02,
    mgp = c(2,0.5,0))

kp <- plotKaryotype(genome="hg19", chromosomes="chr8")
kpPlotMarkers(kp, data=genes, labels=genes$hgnc_symbol)

# jittered vertical position

kpPlotRegions(
  kp,
  data = genes,
  col = disease_colors
)


legend(
  x      = "bottomright",
  legend = names(disease_colors),
  text.width = strwidth(names(disease_colors)),
  col    = disease_colors,
  pch    = 19,
  bty    = 'n',
  inset  = c(0.4, 0),
  xpd    = NA,
  horiz  = TRUE
)

dev.off()





kpPoints(kp,
         data = genes[genes$group == "NCS", ],
         col  = disease_colors["NCS"],
         pch  = 16,
         cex  = 0.5,
         r0   = 0.1,
         r1   = 0.3)

kpPoints(kp,
         data = genes[genes$group == "HGPS", ],
         col  = disease_colors["HGPS"],
         pch  = 16,
         cex  = 0.5,
         r0   = 0.4,
         r1   = 0.6)

kpPoints(kp,
         data = genes[genes$group == "Werner", ],
         col  = disease_colors["Werner"],
         pch  = 16,
         cex  = 0.5,
         r0   = 0.7,
         r1   = 0.9)


invisible(dev.off())




library(missMethyl)
library(dplyr)
library(ggplot2)

# -------------------------
# 1. Subset methylation matrix to CpGs in ncs_int_jacked
# -------------------------

int_ncs_mean <- data_ncs_noSNP[ncs_int_jacked$cg, ]

noint_werner_mean <- data_werner_noSNP[names(werner_noint), ]

int_progeria_mean <- data_progeria_noSNP[rownames(res_progeria_2),]

ncs_jacked <- intersect(ncs_noint_jacked$cg, ncs_int_jacked$cg)

ncs_noint_hypo <- ncs_noint_jacked %>%
  dplyr::filter(pvalue_jack <= 0.05) %>%
  arrange(pvalue_jack) %>%
  dplyr::filter(delta_beta<0)

ncs_noint_hypo <- head(ncs_noint_hypo$cg, 500)

ncs_noint_hyper <- ncs_noint_jacked %>%
  dplyr::filter(pvalue_jack <= 0.05) %>%
  arrange(pvalue_jack) %>%
  dplyr::filter(delta_beta>0)

ncs_noint_hyper <- head(ncs_noint_hyper$cg, 500)

ncs_int_hypo <- ncs_int_jacked %>%
  dplyr::filter(pvalue_jack <= 0.05) %>%
  arrange(pvalue_jack) %>%
  dplyr::filter(delta_beta<0)

ncs_int_hypo <- head(ncs_int_hypo$cg, 492)

ncs_int_hyper <- ncs_int_jacked %>%
  dplyr::filter(pvalue_jack <= 0.05) %>%
  arrange(pvalue_jack) %>%
  dplyr::filter(delta_beta>0)

ncs_int_hyper <- head(ncs_int_hyper$cg, 500)


ncs_hypo <- ncs_noint_hypo
ncs_hypo <- c(ncs_hypo, ncs_int_hypo)
ncs_hypo <- unique(ncs_hypo)
length(ncs_hypo)

ncs_hyper <- ncs_noint_hyper
ncs_hyper <- c(ncs_hyper, ncs_int_hyper)
ncs_hyper <- unique(ncs_hyper)






werner_noint_hypo <- werner_noint_res %>%
  dplyr::filter(pvalue <= 0.05) %>%
  arrange(pvalue) %>%
  dplyr::filter(delta_beta<0)

werner_noint_hypo_all <- rownames(werner_noint_hypo)
werner_noint_hypo <- head(rownames(werner_noint_hypo), 1000)

werner_noint_hyper <- werner_noint_res %>%
  dplyr::filter(pvalue <= 0.05) %>%
  arrange(pvalue) %>%
  dplyr::filter(delta_beta>0)

werner_noint_hyper_all <- rownames(werner_noint_hyper)
werner_noint_hyper <- head(rownames(werner_noint_hyper), 1000)


werner_int_hypo <- werner_int_res %>%
  dplyr::filter(pvalue <= 0.05) %>%
  arrange(pvalue) %>%
  dplyr::filter(delta_beta<0)
werner_int_hypo_all <- rownames(werner_int_hypo)
werner_int_hypo <- head(rownames(werner_int_hypo), 1000)

werner_int_hyper <- werner_int_res %>%
  dplyr::filter(pvalue <= 0.05) %>%
  arrange(pvalue) %>%
  dplyr::filter(delta_beta>0)
werner_int_hyper <- rownames(werner_int_hyper)
werner_int_hyper <- head(rownames(werner_int_hyper), 1000)

werner_hypo_all <- werner_noint_hypo_all
werner_hypo_all <- c(werner_hypo_all, werner_int_hypo_all)
werner_hypo_all <- unique(werner_hypo_all)
length(werner_hypo)

werner_hyper <- werner_noint_hyper
werner_hyper <- c(werner_hyper, werner_int_hyper)
werner_hyper <- unique(werner_hyper)
length(werner_hyper)





progeria_noint_hypo <- progeria_noint_res %>%
  dplyr::filter(pvalue <= 0.05) %>%
  arrange(pvalue) %>%
  dplyr::filter(delta_beta<0)

progeria_noint_hypo <- head(rownames(progeria_noint_hypo), 1000)

progeria_noint_hyper <- progeria_noint_res %>%
  dplyr::filter(pvalue <= 0.05) %>%
  arrange(pvalue) %>%
  dplyr::filter(delta_beta>0)

progeria_noint_hyper <- head(rownames(progeria_noint_hyper), 1000)


progeria_int_hypo <- progeria_int_res %>%
  dplyr::filter(pvalue <= 0.05) %>%
  arrange(pvalue) %>%
  dplyr::filter(delta_beta<0)

progeria_int_hypo <- head(rownames(progeria_int_hypo), 1000)

progeria_int_hyper <- progeria_int_res %>%
  dplyr::filter(pvalue <= 0.05) %>%
  arrange(pvalue) %>%
  dplyr::filter(delta_beta>0)

progeria_int_hyper <- head(rownames(progeria_int_hyper), 1000)

progeria_hypo <- progeria_noint_hypo
progeria_hypo <- c(progeria_hypo, progeria_int_hypo)
progeria_hypo <- unique(progeria_hypo)
length(progeria_hypo)

progeria_hyper <- progeria_noint_hyper
progeria_hyper <- c(progeria_hyper, progeria_int_hyper)
progeria_hyper <- unique(progeria_hyper)
length(progeria_hyper)

progeria_all <- progeria_hypo
progeria_all <- c(progeria_hypo)

# -------------------------
# 2. Split samples by group
# -------------------------
control_samples <- colnames(data_progeria_noSNP)[data_progeria_noSNP$diagnosis == "control HGPS"]
disease_samples <- colnames(data_progeria_noSNP)[data_progeria_noSNP$diagnosis == "HGPS"]

control_samples <- colnames(data_ncs_noSNP)[data_ncs_noSNP$diagnosis == "control NCS"]
disease_samples <- colnames(data_ncs_noSNP)[data_ncs_noSNP$diagnosis == "NCS"]


control_samples <- colnames(data_werner_noSNP)[data_werner_noSNP$diagnosis == "control Werner"]
disease_samples <- colnames(data_werner_noSNP)[data_werner_noSNP$diagnosis == "Werner"]


int_ncs_control <- int_ncs_mean[, control_samples]
int_ncs_disease <- int_ncs_mean[, disease_samples]

int_progeria_control <- int_progeria_mean[, control_samples]
int_progeria_disease <- int_progeria_mean[, disease_samples]

noint_werner_control <- noint_werner_mean[, control_samples]
noint_werner_disease <- noint_werner_mean[, disease_samples]
# -------------------------
# 3. Compute CpG-wise means
# -------------------------
mean_control <- rowMeans(noint_werner_control, na.rm = TRUE)
mean_disease <- rowMeans(noint_werner_disease, na.rm = TRUE)

# Compute delta beta (disease - control)
delta_beta <- mean_disease - mean_control

# -------------------------
# 4. Add delta_beta to ncs_int_jacked
# -------------------------

progeria_int_res <- res_progeria_2
progeria_int_res$delta_beta <- delta_beta[rownames(progeria_int_res)]

ncs_int_jacked$delta_beta <- delta_beta[ncs_int_jacked$cg]

werner_noint_res <- res_werner_1
werner_noint_res$delta_beta <- delta_beta[rownames(werner_noint_res)]


names(werner_int_beta_vals) <- werner_int_all
werner_int_beta_vals <- delta_beta[werner_int_all]

# -------------------------
# 5. Define up- and down-regulated CpGs
# -------------------------
ncs_noint_upregulated <- ncs_noint_jacked$cg[ncs_noint_jacked$delta_beta > 0]
ncs_noint_downregulated   <- ncs_noint_jacked$cg[ncs_noint_jacked$delta_beta < 0]

werner_int_hypo <- names(delta_beta)[delta_beta <0]
werner_int_hyper <- names(delta_beta)[delta_beta >0]
# -------------------------
# 6. Rank CpGs by p-value and select top 100
# -------------------------
# Downregulated
df_down_werner_int_hypo <- werner_int_hypo %>%
  filter(cg %in% names(werner_all_int)) %>%
  arrange(pvalue_jack)

werner_int_downregulated_top100 <- head(df_down_ncs_int$cg, 300)
ncs_noint_top100 <- ncs_int_jacked %>%
  arrange(pvalue_jack)
# Upregulated
df_up_ncs_noint <- ncs_noint_jacked %>% 
  filter(cg %in% ncs_noint_upregulated) %>%
  arrange(pvalue_jack)

werner_int_hypo_top100 <- head(werner_int_hypo, 100)
werner_int_hyper_top100 <- head(werner_int_hyper, 100)

werner_int_top <- werner_int_hypo_top100
werner_int_top <- c(werner_int_top, werner_int_hyper_top100)
werner_int_top <- unique(werner_int_top)
# -------------------------
# 7. Run gometh() for downregulated CpGs
# -------------------------
go_ncs_int_hyper <- gometh(
  sig.cpg = ncs_int_hyper,
  all.cpg = rownames(data_progeria_noSNP),
  collection = "GO"
)

go_df_werner_noint_up <- as.data.frame(go_werner_noint_up)

go_df_ncs_jacked <- as.data.frame(go_ncs_jacked)

go_df_werner_noint_all <- as.data.frame(go_werner_noint)

# -------------------------
# 8. Plot top 10 Molecular Function GO terms
# -------------------------
top_go <- go_ncs_int_hyper %>%
  dplyr::filter(ONTOLOGY == "CC") %>%
  arrange(FDR) %>%
  slice_head(n = 10)

#pdf("Top_GO_BP_ncs_noint_hyper.pdf", width = 9, height = 6)
ggplot(top_go, aes(x = reorder(TERM, -log10(FDR)), y = -log10(FDR))) +
  geom_col(fill = "steelblue3") +
  coord_flip() +
  geom_hline(yintercept = 1.3, color = "red", linetype = "dashed", size = 1) +  # vertical line in flipped plot
  labs(
    x = "",
    y = "-log10(FDR)",
    title = "Biological process GO - HGPS hypomethylated genes from static models"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(
      hjust = 1,
      margin = margin(b = 10)
    )
  )

dev.off()





# "#60BD68"
# "steelblue3", "slateblue3"
# -------------------------
# 9. Optional sanity checks
# -------------------------
stopifnot(length(ncs_int_downregulated_top100) > 0)
stopifnot(all(ncs_int_downregulated_top100 %in% rownames(data_ncs_jacked_noSNP)))
